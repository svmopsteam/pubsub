!function(){var t,e,i,s,n,o,r,a;(n=t||(t={})).GET_SDK_CONFIG="getSdkConfig",n.IS_EMBEDDED="embed",n.PARENT_DOMAIN="parentDomain",(o=e||(e={})).CONFIG="config",o.CONFIG_REQUESTED="configRequested",(r=i||(i={})).COLOR_MODE="color-mode",r.PLAY_MESSAGE_SOUND="play-message-sound",r.ROOM_NAME="room",r.ROOT_URL="root-url",r.USER_ID="user-id",r.USER_NAME="user-name";let l=t=>{let{data:e}=t;return"object"==typeof e&&null!==e&&"name"in e&&"string"==typeof e.name&&"payload"in e&&"object"==typeof e.payload};(a=s||(s={})).DARK="dark",a.LIGHT="light";let u=Object.values(s).map(String),h=t=>u.includes(t),c=["camera","microphone","display-capture","fullscreen"],g=["height","referrerpolicy","sandbox","style","width"];class d extends HTMLElement{static get observedAttributes(){return[...Object.values(i),...g]}get chatConfig(){let t={};this.hasAttribute(i.USER_ID)&&(t.userId=this.getAttribute(i.USER_ID)??""),this.hasAttribute(i.USER_NAME)&&(t.customUsername=this.getAttribute(i.USER_NAME)),t.playSoundOnNewMessage=!!this.hasAttribute(i.PLAY_MESSAGE_SOUND);let e=this.getAttribute(i.COLOR_MODE)??"";return h(e)&&(t.colorMode=e),t}get rootUrl(){return this.getAttribute(i.ROOT_URL)??"https://chitchatter.im/"}async listenForConfigRequest(){this.stopListeningForConfigRequest(),window.addEventListener("message",this.handleConfigRequestedMessage),this.configRequestExpirationTimout=setTimeout(()=>{console.error("[chitchatter-sdk] configuration was not sent successfully"),this.stopListeningForConfigRequest()},1e4)}updateIframeAttributes(){let{iframe:e}=this,s=encodeURIComponent(this.getAttribute(i.ROOM_NAME)??window.location.href),n=new URLSearchParams({[t.IS_EMBEDDED]:"",[t.GET_SDK_CONFIG]:"",[t.PARENT_DOMAIN]:encodeURIComponent(window.location.origin)}),o=new URL(this.rootUrl);o.pathname=`public/${s}`,o.search=n.toString();let{href:r}=o;for(let t of(r!==e.getAttribute("src")&&e.setAttribute("src",r),g)){let i=this.getAttribute(t);null!==i&&e.setAttribute(t,i)}}connectedCallback(){let t=this.attachShadow({mode:"open"}),{iframe:e}=this;e.style.border="none",e.setAttribute("allow",c.join(";")),t.appendChild(e),e.addEventListener("load",()=>{this.listenForConfigRequest()})}disconnectedCallback(){this.stopListeningForConfigRequest()}attributeChangedCallback(t){this.updateIframeAttributes(),Object.values(i).map(String).includes(t)&&this.sendConfigToChat()}constructor(...t){super(...t),this.configRequestExpirationTimout=null,this.iframe=document.createElement("iframe"),this.sendConfigToChat=()=>{let{iframe:t,rootUrl:i}=this,{origin:s}=new URL(i),n={name:e.CONFIG,payload:this.chatConfig};t.contentWindow?.postMessage(n,s)},this.handleConfigRequestedMessage=t=>{let{rootUrl:i}=this,{origin:s}=new URL(i);s===t.origin&&l(t)&&t.data.name===e.CONFIG_REQUESTED&&(this.sendConfigToChat(),this.stopListeningForConfigRequest())},this.stopListeningForConfigRequest=()=>{window.removeEventListener("message",this.handleConfigRequestedMessage),null!==this.configRequestExpirationTimout&&(clearInterval(this.configRequestExpirationTimout),this.configRequestExpirationTimout=null)}}}window.customElements.define("chat-room",d)}();
//# sourceMappingURL=sdk.js.map
